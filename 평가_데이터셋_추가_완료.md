# 평가 데이터셋 경로 설정 기능 추가 완료

## 문제 상황

기존 구현에서는 **평가 데이터셋 경로가 고정**되어 있었습니다:
- Query: `data/aihub_kaist/query` (고정)
- Gallery: `data/aihub_kaist/bounding_box_test` (고정)

Sample 데이터로 빠른 테스트를 하고 싶었지만, 훈련 폴더만 변경할 수 있고 평가 데이터는 항상 전체 데이터를 사용해야 했습니다.

## 해결 방법

### 1. 데이터셋 클래스 확장

`data/datasets/aihub_kaist.py`에 `query_folder`와 `gallery_folder` 파라미터를 추가했습니다.

**변경 전:**
```python
def __init__(self, root='./data', train_folder='bounding_box_train_1', verbose=True, **kwargs):
    self.query_dir = osp.join(self.dataset_dir, 'query')
    self.gallery_dir = osp.join(self.dataset_dir, 'bounding_box_test')
```

**변경 후:**
```python
def __init__(self, root='./data', train_folder='bounding_box_train_1', 
             query_folder='query', gallery_folder='bounding_box_test', 
             verbose=True, **kwargs):
    self.query_dir = osp.join(self.dataset_dir, query_folder)
    self.gallery_dir = osp.join(self.dataset_dir, gallery_folder)
```

### 2. 설정 시스템 확장

`config/defaults.py`에 새로운 설정 항목을 추가했습니다:

```python
_C.DATASETS.QUERY_FOLDER = 'query'
_C.DATASETS.GALLERY_FOLDER = 'bounding_box_test'
```

### 3. 데이터 로더 수정

`data/build.py`에서 AIHub KAIST 데이터셋 사용 시 새 파라미터를 전달하도록 했습니다:

```python
if cfg.DATASETS.NAMES == 'aihub_kaist':
    dataset_kwargs['train_folder'] = cfg.DATASETS.TRAIN_FOLDER
    dataset_kwargs['query_folder'] = cfg.DATASETS.QUERY_FOLDER
    dataset_kwargs['gallery_folder'] = cfg.DATASETS.GALLERY_FOLDER
```

## 사용 가능한 데이터셋 조합

### 전체 데이터셋

| 폴더 | Person IDs | 이미지 수 | 용도 |
|------|-----------|----------|------|
| bounding_box_train_1 | 188 | 20,119 | 훈련 |
| bounding_box_train_2 | 175 | 18,476 | 훈련 |
| bounding_box_train_3 | 175 | 18,495 | 훈련 |
| query | 145 | 1,065 | 쿼리 |
| bounding_box_test | 145 | 15,385 | 갤러리 |

### Sample 데이터셋

| 폴더 | Person IDs | 이미지 수 | 용도 |
|------|-----------|----------|------|
| sample_train | 100 | 2,838 | 훈련 |
| sample_query | 100 | 732 | 쿼리 |
| sample_test | 100 | 11,047 | 갤러리 |
| sample_query_reduced | 100 | 382 | 쿼리 (축소) |
| sample_test_reduced | 100 | 1,199 | 갤러리 (축소) |

## 새로 추가된 설정 파일

### 1. test_aihub_kaist_sample.yml

Sample 데이터 전체를 사용하는 테스트 설정:

```yaml
DATASETS:
  NAMES: 'aihub_kaist'
  TRAIN_FOLDER: 'sample_train'
  QUERY_FOLDER: 'sample_query'
  GALLERY_FOLDER: 'sample_test'
```

**사용 방법:**
```bash
python3 tools/train.py --config_file configs/test_aihub_kaist_sample.yml
```

**예상 시간:** 5-10분

### 2. test_aihub_kaist_sample_reduced.yml

축소된 Sample 데이터를 사용하는 초고속 테스트 설정:

```yaml
DATASETS:
  NAMES: 'aihub_kaist'
  TRAIN_FOLDER: 'sample_train'
  QUERY_FOLDER: 'sample_query_reduced'
  GALLERY_FOLDER: 'sample_test_reduced'
```

**사용 방법:**
```bash
python3 tools/train.py --config_file configs/test_aihub_kaist_sample_reduced.yml
```

**예상 시간:** 3-5분

### 3. test_aihub_kaist_quick.yml (수정됨)

빠른 테스트를 위해 sample 데이터를 사용하도록 변경:

```yaml
DATASETS:
  NAMES: 'aihub_kaist'
  TRAIN_FOLDER: 'sample_train'
  QUERY_FOLDER: 'sample_query'
  GALLERY_FOLDER: 'sample_test'
```

## 테스트 결과

모든 조합이 정상 작동함을 확인했습니다:

### Sample 데이터 테스트
```
Train:   100 PIDs, 2,838 이미지
Query:   100 PIDs, 732 이미지  
Gallery: 100 PIDs, 11,047 이미지
```

### Sample Reduced 데이터 테스트
```
Train:   100 PIDs, 2,838 이미지
Query:   100 PIDs, 382 이미지
Gallery: 100 PIDs, 1,199 이미지
```

### 전체 데이터 테스트 (기존 호환성 확인)
```
Train:   188 PIDs, 20,119 이미지
Query:   145 PIDs, 1,065 이미지
Gallery: 145 PIDs, 15,385 이미지
```

## 커스텀 조합 사용하기

명령줄에서 평가 데이터셋을 자유롭게 조합할 수 있습니다:

### 예시 1: 전체 훈련 + 샘플 평가

```bash
python3 tools/train.py --config_file configs/aihub_kaist.yml \
  DATASETS.TRAIN_FOLDER 'bounding_box_train_1' \
  DATASETS.QUERY_FOLDER 'sample_query_reduced' \
  DATASETS.GALLERY_FOLDER 'sample_test_reduced' \
  SOLVER.MAX_EPOCHS 10
```

### 예시 2: 샘플 훈련 + 전체 평가

```bash
python3 tools/train.py --config_file configs/aihub_kaist.yml \
  DATASETS.TRAIN_FOLDER 'sample_train' \
  DATASETS.QUERY_FOLDER 'query' \
  DATASETS.GALLERY_FOLDER 'bounding_box_test' \
  SOLVER.MAX_EPOCHS 5
```

### 예시 3: 빠른 파이프라인 검증

```bash
python3 tools/train.py --config_file configs/test_aihub_kaist.yml \
  DATASETS.TRAIN_FOLDER 'sample_train' \
  DATASETS.QUERY_FOLDER 'sample_query_reduced' \
  DATASETS.GALLERY_FOLDER 'sample_test_reduced' \
  SOLVER.MAX_EPOCHS 1 \
  WANDB.ENABLE False
```

## 권장 워크플로우

### 1단계: 초고속 검증 (3-5분)
```bash
python3 tools/train.py --config_file configs/test_aihub_kaist_sample_reduced.yml
```
- 파이프라인 전체가 정상 작동하는지 확인
- 코드 변경 후 즉시 검증

### 2단계: 빠른 테스트 (5-10분)
```bash
python3 tools/train.py --config_file configs/test_aihub_kaist_sample.yml
```
- Sample 데이터로 기본 성능 확인
- Triplet Loss까지 포함한 검증

### 3단계: 표준 테스트 (20-30분)
```bash
python3 tools/train.py --config_file configs/test_aihub_kaist.yml
```
- 전체 데이터로 짧은 학습
- 실제 성능 예측 가능

### 4단계: 전체 학습 (8-12시간)
```bash
python3 tools/train.py --config_file configs/aihub_kaist.yml
```
- 최종 모델 학습
- 120 에포크 전체 학습

## 파일 수정 내역

### 수정된 파일

1. `data/datasets/aihub_kaist.py` - query_folder, gallery_folder 파라미터 추가
2. `config/defaults.py` - QUERY_FOLDER, GALLERY_FOLDER 설정 추가
3. `data/build.py` - 새 파라미터 전달 로직 추가

### 추가된 파일

1. `configs/test_aihub_kaist_sample.yml` - Sample 전체 데이터 테스트 설정
2. `configs/test_aihub_kaist_sample_reduced.yml` - 축소 Sample 데이터 테스트 설정

### 업데이트된 파일

1. `configs/aihub_kaist.yml` - QUERY_FOLDER, GALLERY_FOLDER 명시
2. `configs/test_aihub_kaist.yml` - QUERY_FOLDER, GALLERY_FOLDER 명시
3. `configs/test_aihub_kaist_quick.yml` - sample 데이터 사용으로 변경
4. `configs/test_aihub_kaist_train2.yml` - QUERY_FOLDER, GALLERY_FOLDER 명시
5. `configs/test_aihub_kaist_train3.yml` - QUERY_FOLDER, GALLERY_FOLDER 명시
6. `configs/README_TEST_CONFIGS.md` - 새 설정 파일 설명 추가

## 이점

1. **개발 속도 향상**: Sample 데이터로 3-5분 만에 파이프라인 검증
2. **유연한 실험**: 훈련/평가 데이터를 자유롭게 조합 가능
3. **리소스 절약**: 작은 데이터로 알고리즘 검증 후 전체 학습
4. **하위 호환성**: 기본값이 기존 동작과 동일하여 기존 코드 영향 없음

## 참조

- 데이터셋 클래스: `data/datasets/aihub_kaist.py` (23-38행)
- 설정 정의: `config/defaults.py` (77-79행)
- 데이터 로더: `data/build.py` (22-25행)
- 테스트 설정: `configs/README_TEST_CONFIGS.md`

